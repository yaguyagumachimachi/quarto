{
  "hash": "8a789cab391b3f5a411af42f6eb29b42",
  "result": {
    "markdown": "---\ntitle: \"PodmanでRstudio環境構築\"\nauthor: \"guchiguchi\"\ndate: today\ncategories: [Podman, R, Rstudio]\nimage: \"podman.png\"\ndraft: true\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n## はじめに\n\nWindowsでPodmanの分析環境を作成したときのメモ。\ndockerが一部有料化されてライセンスの確認など面倒、、、、\n\nと思い [podman](https://podman.io/)\n\nいろいろ躓いたのでめも。\n\n## Install\n\n### mac\n\nまずは適当にインストールする。\n\nmacなら\n\n``` bash\nbrew install podman\n```\n\nPodman Desktopもインストールしておくといいかも。\n\n<https://podman-desktop.io/>\n\n``` bash\nbrew install podman-desktop\n```\n\n### Windows\n\n結構はまったので順番違うかも。Windowsのアップデートで立ち上がらなくなったりしたので注意。\n\n1.  wslのインストール確認\n\n    このあたりを確認する。https://learn.microsoft.com/ja-jp/windows/wsl/install\n\n    Powersehllで`wsl –help` すれば大体わかる\n\n2.  wslにPodmanインストール\n\n    Powershellからwslにはいる\n\n    ``` powershell\n    wsl\n    ```\n\n    なにをwslに入れたかによるがこれでインストール\n\n    ``` bash\n    sudo apt-get -y update\n    sudo apt-get -y install podman\n    ```\n\n3.  PC上にPodmanインストール\n\n    このあたりからダウンロードしてクリック\n\n    https://github.com/containers/podman/blob/main/docs/tutorials/podman-for-windows.md\n\n    https://github.com/containers/podman/releases\n\n4.  Podman Desktopのインストール\n\n    https://podman-desktop.io/\n\n## machine init\n\n### メモリ, CPU, Disk\n\ndocker desktopでは後で変更できた気がするが、\npodmanではわからなかった。。。 各自のPCスペックなどをもとに変えること。\n\n``` bash\npodman machine init --cpus 8 --memory 16384 --disk-size 500\npodman machine set --rootful\npodman machine start\n```\n\n## image pull\n\nimageをpullします。 自分のでもいいし、docker hubから持ってくるなど。\n\n``` bash\npodman pull docker.io/rocker/rstudio:latest\n```\n\n## podman run\n\n以下、Rstudioの環境のイメージ、rockerでのつまづきポイント。\n\n-   rootに設定しておく\n\n    -   権限の問題でrstudioが起動しない\n\n-   パスワードは設定しておく\n\n    -   昔は設定しない場合パスはrstudioでログインできた気がする。\n        どこのサイトかわすれたが最近設定しないとだめになったぽい。\n\n-   マウント\n\n    -   例えば、\"/Users//Desktop/\"だったら\"/mnt/Users/Desktop/test\"にかえる。\n        init時のやり方でかえる。\n\n-   個人的な好みだけどポートは変える\n\n    -   いくつかコンテナ作成すると競合したりするので。デフォルトは8787\n\n-   -dをわすれない\n\n    -   分析環境は立ち上げ続ける必要があるので。\n\n以下を反映するとこんな感じ\n\n``` bash\npodman run -ti -p 9787:8787 -e PASSWORD=sukina_word -e ROOT=TRUE -m=16g -v C:/Users/ynwa1/Documents/study:/home/rstudio -d --name r_stan_env_pod rocker/rstudio:latest\n```\n\n## Login\n\nポートを変えたので以下でログイン\n\nhttp://localhost:9787/\n\nユーザー名:rstudio\n\npass:podman run したときのPASSWORD\n\n## その他\n\n過去にコンテナを作成したディレクトリにマウントしたりすると権限の関係でエラーが出たりする。\n適宜コンテナにはいって ローカルマシンから\n\n``` bash\npodman exec -u root -it r_stan_env_pod bash\n```\n\nしてコンテナ内に入り、ログを見ながら権限変更する\n\n``` bash\nchmod 777 -R /home/rstudio/.local/share/rstudio\n```\n\n## session\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.2 (2022-10-31)\n os       Ubuntu 22.04.1 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Etc/UTC\n date     2023-01-07\n pandoc   2.19.2 @ /usr/local/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n cli           3.5.0   2022-12-20 [1] RSPM (R 4.2.0)\n digest        0.6.31  2022-12-11 [1] RSPM (R 4.2.0)\n evaluate      0.19    2022-12-13 [1] RSPM (R 4.2.0)\n fastmap       1.1.0   2021-01-25 [1] RSPM (R 4.2.0)\n glue          1.6.2   2022-02-24 [1] RSPM (R 4.2.0)\n htmltools     0.5.4   2022-12-07 [1] RSPM (R 4.2.0)\n htmlwidgets   1.6.0   2022-12-15 [1] RSPM (R 4.2.0)\n jsonlite      1.8.4   2022-12-06 [1] RSPM (R 4.2.0)\n knitr         1.41    2022-11-18 [1] RSPM (R 4.2.0)\n lifecycle     1.0.3   2022-10-07 [1] RSPM (R 4.2.0)\n magrittr      2.0.3   2022-03-30 [1] RSPM (R 4.2.0)\n rlang         1.0.6   2022-09-24 [1] RSPM (R 4.2.0)\n rmarkdown     2.19    2022-12-15 [1] RSPM (R 4.2.0)\n sessioninfo   1.2.2   2021-12-06 [1] RSPM (R 4.2.0)\n stringi       1.7.8   2022-07-11 [1] RSPM (R 4.2.0)\n stringr       1.5.0   2022-12-02 [1] RSPM (R 4.2.0)\n vctrs         0.5.1   2022-11-16 [1] RSPM (R 4.2.0)\n xfun          0.36    2022-12-21 [1] RSPM (R 4.2.0)\n yaml          2.3.6   2022-10-18 [1] RSPM (R 4.2.0)\n\n [1] /usr/local/lib/R/site-library\n [2] /usr/local/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}